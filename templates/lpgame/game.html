{% extends 'base.html' %}
{% block content %}
{% load url from future %}
<div class="container">
    <div class="nanana">
    {% for letters in rows %}
        <div class="row-fluid show-grid">
        {% for entry in letters %}
            <a href="#" class="letter">
            <div class="span1" id="letter_{{ entry.letter_id }}" style="text-align:center;">
                {{ entry.letter }}
            </div>
            </a>
        {% endfor %}
        </div>
    {% endfor %}
    </div>
    <div class="selected">
    </div>
    <input type="button" id="submit" value="Submit" class="btn"/>
</div>
<script type="text/javascript">
$(document).ready(function (){
    var selected = [];
    var token = "{{ csrf_token }}";
    var session_id = "{{ session_id }}"
    $("a.letter").click(function(){
        var $this = $(this);
        var div = $this.children();
        if (selected.indexOf(div.attr('id')) == -1){
            selected.push(div.attr('id'));
            div.css({'background-color':'gray'});
            console.log(selected);
        }
    });
    $('input#submit').click(function(){
        $.ajax({
            type: "POST",
            url: "/game/make_turn/",
            cache: false,
            data: {
                'selected': selected,
                'csrfmiddlewaretoken': token,
                'session_id': session_id
            },
            dataType: "json"
        }).done(function(data){
            selected = [];
            $('a.letter').children().css({'background-color':'white'});
        })
    })
});
var sock = new SockJS('{{ async_url }}/sockjs');
sock.onopen = function() {
    console.log('open');
    send_session_id()
};
sock.onmessage = function(e) {
    var eventType = e.data.event;
    if (eventType == 'new_turn'){
        console.log(e.data)
        var eventData = JSON.parse(e.data.data);
    }
};
sock.onclose = function() {
    console.log('close');
};
function send_session_id() {
    sock.send(JSON.stringify({
        event: "init",
        session_id: "{{ session_id }}",
    }))
};
</script>
{% endblock %}